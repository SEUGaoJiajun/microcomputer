STACK SEGMENT STACK
	DW 200H DUP(?)
STACK ENDS
DATA SEGMENT
NUM DB ?
LOS DB ?
LOSK DB ?
BUF DB "SUN"
BUFKEY DB "OK"
DATA ENDS
CODE SEGMENT
	ASSUME CS:CODE,SS:STACK,DS:DATA
DELAY PROC       ;延时1s过程                        
      PUSH CX
      PUSH AX
      MOV AX,08FFFH
S:    MOV CX,0FFFFH
F:    DEC CX
      JNE F
      DEC AX
      JNE S          ;循环套循环加强延时效果
      POP AX
      POP CX
      RET
DELAY ENDP
SHOW1 PROC FAR
	PUSH AX
	PUSH BX
	PUSH CX
	PUSH DX
	MOV AH,15
	INT 10H
	MOV AH,0
	INT 10H
	MOV CX,1
	MOV DX,0
R:	MOV AH,2
	INT 10H
	MOV AL,0FH
	MOV AH,10
	INT 10H
	CALL DELAY
	SUB AL,AL
	MOV AH,10
	INT 10H			;清零
	CMP LOSK,10		;补充
	JNB OVER
	INC DH
	ADD DL,2
	CMP DH,25
	JNE R
OVER:	POP DX
	POP CX
	POP BX
	POP AX
        RET
SHOW1 ENDP
SHOW2 PROC FAR
	PUSH CX
	PUSH BX
	PUSH AX
	CMP LOSK,10
	JNB QUT
	MOV CX,3
N:	LODSB					;
	MOV AH,0EH
	MOV BX,01
	INT 10H
	CALL DELAY
	LOOP N
QUT:	POP AX
	POP BX
	POP CX
	RET
SHOW2 ENDP
SHOW2KEY PROC FAR
	PUSH CX
	PUSH BX
	PUSH AX
	CMP LOSK,10
	JNB QUTKEY
	MOV CX,2
NKEY:	LODSB					;
	MOV AH,0EH
	MOV BX,01
	INT 10H
	CALL DELAY
	LOOP NKEY
QUTKEY:	POP AX
	POP BX
	POP CX
	RET
SHOW2KEY ENDP
LOSINT PROC
	PUSH AX
	PUSH SI
	MOV AX,DATA
	MOV DS,AX
	STI
	INC NUM
	CMP NUM,30
	JNE GO
	MOV NUM,0
	MOV SI,OFFSET BUF
	CALL SHOW2
	INC LOS
GO:	POP SI
	POP AX
	IRET
LOSINT ENDP
KBINT PROC FAR
	PUSH AX
	PUSH SI
	STI
	IN AL,60H
	MOV AH,AL
	IN AL,61H
	OR AL,80H
	OUT 61H,AL
	AND AL,7FH
	OUT 61H,AL
	TEST AH,80H
	JNE GOTO
	STI
	INC LOSK
	MOV SI,OFFSET BUFKEY
	CALL SHOW2
GOTO:	MOV AL,20H
	OUT 20H,AL
	POP SI
	POP AX
	IRET
KBINT ENDP
BEGIN:	MOV AX,STACK
	MOV SS,AX
	MOV AX,DATA
	MOV DS,AX
	MOV AX,0
	MOV ES,AX
	MOV AH,35H
	MOV AL,1CH
	INT 21H
	PUSH BX
	MOV AX,ES
	PUSH AX

	CLI
	PUSH DS
	MOV AX,OFFSET LOSINT
	MOV DX,AX
	MOV AX,SEG LOSINT
	MOV DS,AX
	MOV AH,25H
	MOV AL,1CH
	INT 21H
	POP DS

	MOV AH,35H
	MOV AL,09H
	INT 21H
	MOV AX,BX
	PUSH AX
	MOV AX,ES
	PUSH AX

	PUSH DS
	MOV AX,OFFSET KBINT
	MOV DX,AX
	MOV AX,SEG KBINT
	MOV DS,AX
	MOV AH,25H
	MOV AL,09H
	INT 21H
	POP DS

	STI
	IN AL,21H
	AND AL,11111110B
	OUT 21H,AL
	MOV NUM,0
	MOV LOS,0
AGAIN:	CALL SHOW1
	;CMP LOS,10
	CMP LOSK,10
	JB AGAIN
	CLI
	IN AL,21H
	OR AL,00000001B
	OUT 21H,AL
	POP AX
	MOV DS,AX
	POP DX
	MOV AH,25H
	MOV AL,09H
	INT 21H
	POP AX
	MOV DS,AX
	POP DX
	MOV AH,25H
	MOV AL,1CH
	INT 21H
	STI
	MOV AH,4CH
	INT 21H
CODE ENDS
	END BEGIN