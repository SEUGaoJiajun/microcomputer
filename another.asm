STACK SEGMENT STACK
	DW 200H DUP(?)
STACK ENDS
DATA SEGMENT
NUM DB ?
LOS DB ?
LOSK DB ?
BUF DB "SUN"
BUFKEY DB "OK"
DATA ENDS
CODE SEGMENT
	ASSUME CS:CODE,SS:STACK,DS:DATA
	
DELAY PROC       ;延时1s过程                        
      PUSH CX
      PUSH AX
      MOV AX,0EFFFH    ;实验室0EFFFH
S:    MOV CX,0FFFFH
F:    DEC CX
      JNE F
      DEC AX
      JNE S          ;循环套循环加强延时效果
      POP AX
      POP CX
      RET
DELAY ENDP

DELAY2 PROC       ;延时1s过程                        
      PUSH CX
      PUSH AX
      MOV AX,05555H     ;实验室05555H
S2:    MOV CX,0FFFFH
F2:    DEC CX
      JNE F
      DEC AX
      JNE S          ;循环套循环加强延时效果
      POP AX
      POP CX
      RET
DELAY2 ENDP

SHOW1 PROC FAR
	PUSH AX
	PUSH BX
	PUSH CX
	PUSH DX
	MOV AH,15
	INT 10H
	MOV AH,0
	INT 10H
	MOV CX,1
	MOV DX,0
R:	MOV AH,2
	INT 10H
	MOV AL,0FH
	MOV AH,10
	INT 10H
	CALL DELAY
	SUB AL,AL
	MOV AH,10
	INT 10H			;清零
	INC DH
	ADD DL,2
	CMP LOSK,10		;补充
	JNB OVER
	CMP DH,25
	JNE R
OVER:	POP DX
	POP CX
	POP BX
	POP AX
        RET
SHOW1 ENDP

SHOW2 PROC FAR
	PUSH CX
	PUSH BX
	PUSH AX
	MOV CX,3
N:	LODSB					;
	MOV AH,0EH
	MOV BX,01
	INT 10H
	CALL DELAY2
	;CMP LOSK,10
	;JNB QUT
	LOOP N
QUT:	POP AX
	POP BX
	POP CX
	RET
SHOW2 ENDP

SHOW2KEY PROC FAR
	PUSH CX
	PUSH BX
	PUSH AX
	MOV CX,2
NKEY:	LODSB					;
	MOV AH,0EH
	MOV BX,01
	INT 10H
	CALL DELAY2
	;CMP LOSK,10
	;JNB QUTKEY
	LOOP NKEY
QUTKEY:	POP AX
	POP BX
	POP CX
	RET
SHOW2KEY ENDP

LOSINT PROC FAR
	PUSH AX
	PUSH SI
	MOV AX,DATA
	MOV DS,AX
	STI
	INC NUM
	CMP NUM,200      ;实验室也许是30
	JNE GO
	MOV NUM,0
	MOV SI,OFFSET BUF
	CALL SHOW2
	INC LOS
GO:	POP SI
	POP AX
	IRET
LOSINT ENDP

KBINT PROC FAR

	PUSH AX
	PUSH SI
	STI
	IN AL,60H
	MOV AH,AL
	IN AL,61H
	OR AL,80H
	OUT 61H,AL
	AND AL,7FH
	OUT 61H,AL
	TEST AH,80H
	JNE GOT
	STI
	INC LOSK
	CMP LOSK,10
	JNB GOT
	MOV SI,OFFSET BUFKEY
	CALL SHOW2KEY   ;SHOW2KEY
	;CMP LOSK,10
	;JNB QUTKEY
GOT:	MOV AL,20H
	OUT 20H,AL
	POP SI
	POP AX
	IRET
KBINT ENDP

BEGIN:	MOV AX,STACK
	MOV SS,AX
	MOV AX,DATA
	MOV DS,AX
	MOV AH,35H
	MOV AL,1CH
	INT 21H
	PUSH BX
	PUSH ES

	CLI
	PUSH DS
	MOV DX,OFFSET LOSINT
	MOV AX,SEG LOSINT
	MOV DS,AX
	MOV AH,25H
	MOV AL,1CH
	INT 21H
	POP DS

	MOV AH,35H
	MOV AL,09H
	INT 21H
	PUSH BX
	PUSH ES

	PUSH DS
	MOV DX,OFFSET KBINT
	MOV AX,SEG KBINT
	MOV DS,AX
	MOV AH,25H
	MOV AL,09H
	INT 21H
	POP DS

	STI
	;IN AL,21H
	;AND AL,11111110B
	;OUT 21H,AL
	MOV NUM,0
	MOV LOS,0
	MOV LOSK,0
AGAIN:	CALL SHOW1
	;CMP LOS,10
	CMP LOSK,10
	JB AGAIN
LET:	CLI
	;IN AL,21H
	;OR AL,00000001B
	;OUT 21H,AL
	POP DS
	POP DX
	MOV AH,25H
	MOV AL,09H
	INT 21H
	POP DS
	POP DX
	MOV AH,25H
	MOV AL,1CH
	INT 21H
	STI
	MOV AH,4CH
	INT 21H
CODE ENDS
	END BEGIN